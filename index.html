<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Agora NZ Weather – Smarter Kiwi Weather App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="The only weather app built on real NZ station data with truly practical Kiwi advice."/>
  <style>
    body {
      margin: 0; padding: 0;
      background: #f4f7fb;
      font-family: 'Segoe UI', Arial, sans-serif;
      color: #15304b;
      min-height: 100vh;
    }
    .app-container {
      max-width: 500px; margin: 0 auto; background: #fff;
      border-radius: 12px; box-shadow: 0 5px 30px #193a5e18;
      padding-bottom: 34px; min-height: 100vh;
      display: flex; flex-direction: column;
    }
    header {
      background: linear-gradient(90deg, #004c99 30%, #1ca8dd 100%);
      border-radius: 12px 12px 0 0;
      color: #fff;
      padding: 28px 26px 12px 26px;
      font-size: 1.6em;
      font-weight: bold;
      letter-spacing: 0.01em;
    }
    .subtitle {
      font-size: 1em;
      margin-top: 6px;
      color: #e6eaf1;
      font-weight: 400;
    }
    .weather-card {
      display: flex; align-items: center;
      padding: 24px 26px 14px 26px;
      border-bottom: 1px solid #dde3ea;
    }
    .weather-icon {
      width: 64px; height: 64px; margin-right: 18px;
    }
    .weather-details {
      flex: 1;
    }
    .weather-main {
      font-size: 2.5em; font-weight: 600;
      margin-bottom: 6px;
    }
    .weather-secondary {
      font-size: 1em;
      color: #5b7190;
      margin-bottom: 4px;
    }
    .weather-extra {
      font-size: 0.98em;
      color: #7b92ad;
    }
    .advice {
      padding: 14px 26px 0 26px;
      font-size: 1.11em;
      color: #275788;
      font-weight: 500;
      line-height: 1.45;
    }
    .updated {
      padding: 8px 26px 0 26px;
      font-size: 0.96em;
      color: #90a6be;
    }
    .forecast-row {
      display: flex; flex-direction: row; justify-content: space-between;
      gap: 8px; padding: 12px 16px 0 16px;
    }
    .forecast-card {
      background: #f6fafd;
      border-radius: 7px;
      box-shadow: 0 1px 8px #193a5e18;
      padding: 10px 7px;
      width: 32%;
      min-width: 96px;
      display: flex; flex-direction: column; align-items: center;
      font-size: 0.97em;
    }
    .forecast-card img {
      width: 38px; height: 38px; margin: 2px auto 6px auto;
    }
    .forecast-date { font-weight: 600; margin-bottom: 3px; }
    .forecast-cond { font-size: 0.95em; margin-bottom: 2px; }
    .forecast-temp { font-weight: 500; }
    .error-msg {
      color: #ba1515; padding: 24px 26px; text-align: center;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <header>
      Agora NZ Weather<br>
      <span class="subtitle">The only NZ weather app with real station data & truly practical Kiwi advice.</span>
      <div style="font-size:0.96em; margin-top:9px;">
        Station: <b>Paeroa (Actual Station IPAERO15)</b>
      </div>
    </header>

    <div id="weatherCard" class="weather-card" style="display:none;">
      <img id="weatherIcon" class="weather-icon" src="" alt="Weather Icon"/>
      <div class="weather-details">
        <div class="weather-main" id="temperature"></div>
        <div class="weather-secondary" id="conditions"></div>
        <div class="weather-extra" id="extras"></div>
      </div>
    </div>
    <div class="advice" id="advice" style="display:none;"></div>
    <div class="updated" id="updated"></div>
    <div class="forecast-row" id="forecastRow" style="display:none;"></div>
    <div id="error" class="error-msg" style="display:none;"></div>
  </div>

  <script>
    // --- CONFIG ---
    const apiKey = '17815bdf5f234a62815bdf5f239a6209';
    const stationId = 'IPAERO15';
    // Paeroa, NZ geocoords (for forecast API, not station forecast)
    const paeroaLat = -37.3769;
    const paeroaLon = 175.6756;
    // --- END CONFIG ---

    // WU Current obs
    const obsUrl = `https://api.weather.com/v2/pws/observations/current?stationId=${stationId}&format=json&units=m&apiKey=${apiKey}`;
    // WU 5-day forecast (paeroa geo, not PWS because no PWS forecast)
    const forecastUrl = `https://api.weather.com/v3/wx/forecast/daily/5day?geocode=${paeroaLat},${paeroaLon}&format=json&units=m&language=en-NZ&apiKey=${apiKey}`;

    // icon codes from WU to image
    function getIcon(code) {
      // Use WU icon sprite or fallback to WeatherAPI icons
      // https://docs.google.com/spreadsheets/d/1kOJRCedh6Q_8wIuJ_t3qBYj-MFuv2IgpJEXwS6w9Ydc/edit#gid=0
      if (!code) return "https://cdn.weatherapi.com/weather/64x64/day/122.png";
      code = code.toString();
      return `https://icons.wxug.com/i/c/v4/${code}.svg`;
    }

    function weatherAdvice(tempC, windKph, humidity, condition) {
      if (condition && /thunder/i.test(condition)) return "Thunderstorms possible—check for lightning warnings and avoid open paddocks.";
      if (condition && /rain|showers/i.test(condition)) return "Showers about—take a rain jacket or umbrella.";
      if (tempC <= 5) return "Chilly morning—layer up, especially for school runs or early starts. Plan to be home before dark or pack a warm jacket.";
      if (tempC <= 12) return "Cool and fresh—grab a warm jacket before heading out, especially in the evenings.";
      if (humidity > 95) return "Damp air—watch for fog or condensation, ventilate rooms to keep things dry.";
      if (windKph > 25) return "Breezy—secure outdoor items and take care if cycling.";
      return "Mild and pleasant—enjoy your day!";
    }

    // Format date to day (Fri 25)
    function dayDate(isoStr) {
      let d = new Date(isoStr);
      if (isNaN(d)) d = new Date();
      return d.toLocaleDateString('en-NZ', { weekday: 'short', day: 'numeric' });
    }

    // --- Fetch current obs ---
    function fetchWeather() {
      fetch(obsUrl)
        .then(r => {
          if (!r.ok) throw new Error("Weather Underground station error");
          return r.json();
        })
        .then(data => {
          const obs = data.observations && data.observations[0];
          if (!obs) throw new Error("No observation data available.");
          const tempC = obs.metric.temp;
          const feelsC = obs.metric.heatIndex !== null ? obs.metric.heatIndex : obs.metric.temp;
          const humidity = obs.humidity;
          const windKph = obs.metric.windSpeed;
          const precipMm = obs.metric.precipTotal;
          const condition = obs.wx_phrase || obs.imperial?.wx_phrase || "Unknown";
          const iconCode = (obs.icon_code || "unknown").toString();
          let iconUrl = getIcon(iconCode);

          document.getElementById("temperature").textContent = `${tempC.toFixed(1)}°C`;
          document.getElementById("conditions").textContent = `${condition}, feels like ${feelsC.toFixed(1)}°C`;
          document.getElementById("extras").textContent =
            `Humidity: ${humidity}% | Wind: ${windKph} km/h | Rain today: ${precipMm} mm`;
          document.getElementById("weatherIcon").src = iconUrl;
          document.getElementById("weatherCard").style.display = "flex";
          document.getElementById("advice").textContent = weatherAdvice(tempC, windKph, humidity, condition);
          document.getElementById("advice").style.display = "block";

          // Updated time (local)
          const dt = new Date(obs.obsTimeLocal || obs.obsTimeUtc);
          document.getElementById("updated").textContent =
            `Updated: ${dt.toLocaleString('en-NZ', { hour: '2-digit', minute: '2-digit', hour12: false, weekday: 'short', day: 'numeric' })}`;
        })
        .catch(err => {
          document.getElementById("error").textContent = "Error: " + err.message;
          document.getElementById("error").style.display = "block";
        });
    }

    // --- Fetch 5-day forecast ---
    function fetchForecast() {
      fetch(forecastUrl)
        .then(r => {
          if (!r.ok) throw new Error("Weather Underground forecast error");
          return r.json();
        })
        .then(data => {
          const days = data.dayOfWeek;
          const cond = data.narrative;
          const iconCodes = data.iconCode;
          const minTemps = data.temperatureMin;
          const maxTemps = data.temperatureMax;
          const precip = data.daypart[0].precipChance || [];

          let out = '';
          for (let i = 0; i < 3; ++i) { // Show 3-day
            out += `
              <div class="forecast-card">
                <div class="forecast-date">${days[i]} ${data.validDate[i].slice(8,10)}</div>
                <img src="${getIcon(iconCodes[i])}" alt="icon"/>
                <div class="forecast-cond">${cond[i]}</div>
                <div class="forecast-temp">${minTemps[i]}–${maxTemps[i]}°C</div>
                <div style="font-size:0.90em;color:#7b92ad;">Rain: ${precip[i * 2] || 0}%</div>
              </div>
            `;
          }
          document.getElementById("forecastRow").innerHTML = out;
          document.getElementById("forecastRow").style.display = "flex";
        })
        .catch(err => {
          // Don't crash app if forecast fails, just hide
          document.getElementById("forecastRow").style.display = "none";
        });
    }

    // --- INIT ---
    fetchWeather();
    fetchForecast();
  </script>
</body>
</html>