<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Agora Mobile Weather – NZ</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
  body {margin:0;padding:0;font-family:sans-serif;background:#181e2a;color:#fff;}
  #main{max-width:600px;margin:auto;padding:10px;}
  .block{background:#222c40;border-radius:10px;padding:12px;margin-bottom:12px;}
  #loc{font-size:1.2rem;margin-bottom:6px;}
  .row{display:flex;justify-content:space-between;align-items:center;}
  .temp{font-size:2.8rem;}
  .icon{width:60px;height:60px;}
  .details{font-size:0.9rem;color:#adb6c7;margin-top:6px;}
  .advice{background:#253e62;padding:8px;border-radius:6px;margin-top:8px;line-height:1.3;}
  canvas{width:100%;height:150px;background:#222c40;border-radius:10px;}
  .forecast-item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-top:1px solid #333;}
  .forecast-item:first-child{border-top:none;}
  .forecast-item .day{font-weight:bold;width:60px;}
  .forecast-item .ico{width:40px;height:40px;}
  .forecast-item .info{flex:1;font-size:0.9rem;}
</style>
</head>
<body>
<div id="main">
  <div class="block" id="current">
    <div id="loc">Detecting location…</div>
    <div class="row">
      <div class="temp" id="temp">--°C</div>
      <img id="icon" class="icon" src="" alt=""/>
    </div>
    <div class="row details">
      <span id="condition">--</span>
      <span id="wind">Wind: -- km/h</span>
      <span id="gust">Gusts: -- km/h</span>
    </div>
    <div class="details">
      <span id="feels">Feels like: --°C</span><br/>
      <span id="hum">Humidity: --%</span><br/>
      <span id="dew">Dew point: --°C</span>
    </div>
    <div class="advice" id="advice">Getting advice…</div>
  </div>

  <div class="block">
    <canvas id="rainChart"></canvas>
  </div>

  <div class="block" id="forecast">
    <!-- Forecast days inserted here -->
  </div>
</div>

<script>
(async function(){
  const apikey = 'YOUR_KEY'; // XWeather key
  const loc = await fetch('https://ipapi.co/json').then(r=>r.json());
  const lat=loc.latitude, lon=loc.longitude;
  document.getElementById('loc').textContent = loc.city + ', ' + loc.region;
  const [cur,fore,hist] = await Promise.all([
    fetch(`https://data.api.xweather.com/conditions/${lat},${lon}?format=json&plimit=1&fields=...&client_id=...`).then(r=>r.json()),
    fetch(`https://data.api.xweather.com/forecasts/${lat},${lon}?format=json&plimit=8&fields=...&client_id=...`).then(r=>r.json()),
    fetch(`https://api.visualcrossing.com/...&lat=${lat}&lon=${lon}`).then(r=>r.json())
  ]);
  
  // Populate current
  const p = cur.response[0].periods[0];
  document.getElementById('temp').textContent = Math.round(p.tempC)+'°C';
  document.getElementById('icon').src = `https://cdn.aerisapi.com/wxblox/icons/${p.icon}`;
  document.getElementById('condition').textContent = p.weather;
  document.getElementById('wind').textContent = 'Wind: '+Math.round(p.windSpeedKPH)+' km/h';
  document.getElementById('gust').textContent = 'Gusts: '+Math.round(p.windGustKPH)+' km/h';
  document.getElementById('feels').textContent = 'Feels like: '+Math.round(p.feelslikeC)+'°C';
  document.getElementById('hum').textContent = 'Humidity: '+p.humidity+'%';
  document.getElementById('dew').textContent = 'Dew point: '+Math.round(p.dewpointC)+'°C';
  
  // Advice logic
  const d = {temp:p.tempC,humidity:p.humidity,precip:p.precipMM||0,gust:p.windGustKPH,hail:(p.weather||'').toLowerCase().includes('hail'),weather:p.weather,month:(new Date(p.dateTimeISO)).getMonth()+1};
  const adviceArr = [];
  // triggers
  if(d.precip>=20) adviceArr.push("Heavy rain likely—best to stay indoors or bring waterproof gear.");
  if(d.gust>=60) adviceArr.push("Strong winds—secure anything that could blow away.");
  if(/thunder/i.test(d.weather)) adviceArr.push("Thunderstorms possible—find shelter if outside.");
  if(d.temp>=28) adviceArr.push("Hot day—hydrate often and wear sunscreen."); 
  if(d.temp<=0) adviceArr.push("Freezing temps—watch for icy surfaces.");
  // seasonal
  if(d.month>=12||d.month<=2) adviceArr.push("Summer UV high—wear a hat & sunscreen.");
  else if(d.month>=6&&d.month<=8) adviceArr.push("Winter chill—wrap up warmly & check frost.");
  // general rotation
  const general=["Carry an umbrella", "Check UV index before heading out", "Dress in layers as weather changes","Have a basic emergency kit handy"];
  const g = general[(new Date()).getDate()%general.length];
  adviceArr.push(g);
  document.getElementById('advice').textContent = [...new Set(adviceArr)].slice(0,2).join(' | ');
  
  // Forecast
  const fdom = document.getElementById('forecast');
  fore.response[0].periods.slice(1,8).forEach(p2=>{
    const day = new Date(p2.dateTimeISO).toLocaleDateString('en-NZ',{weekday:'short'});
    const item = document.createElement('div'); item.className='forecast-item';
    item.innerHTML=`
      <div class="day">${day}</div>
      <img class="ico" src="https://cdn.aerisapi.com/wxblox/icons/${p2.icon}" alt=""/>
      <div class="info">
        <div>${Math.round(p2.maxTempC)}/${Math.round(p2.minTempC)}°C</div>
        <div>Wind ${Math.round(p2.windSpeedKPH)}km/h gusts ${Math.round(p2.windGustKPH)}km/h</div>
        <div>Rain ${p2.precipMM||0}mm • Hum ${p2.humidity}%</div>
      </div>`;
    fdom.appendChild(item);
  });
  
  // Historical chart
  const ctx = document.getElementById('rainChart').getContext('2d');
  const labels = hist.days.map(d=>d.datetime);
  const data = hist.days.map(d=>d.precip);
  new Chart(ctx,{type:'line',data:{labels,dataSets:[{label:'Daily Rain (mm)',data:hist.days.map(d=>d.precip),borderColor:'#85e7ff',fill:false}]},options:{scales:{y:{beginAtZero:true}}}});
})();
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>