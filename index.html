<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Agora NZ Weather â€“ Real Paeroa Data</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body {
      margin: 0; padding: 0;
      background: #f4f7fb;
      font-family: 'Segoe UI', Arial, sans-serif;
      color: #15304b;
      min-height: 100vh;
    }
    .container {
      max-width: 640px;
      margin: 0 auto;
      padding: 20px;
    }
    .header {
      background: linear-gradient(90deg,#134574,#2183bc);
      color: #fff;
      padding: 16px 18px 8px 18px;
      font-size: 1.23em;
      border-radius: 0 0 18px 18px;
      font-weight: 500;
    }
    .card {
      background: #eaf3fc;
      margin-top: 24px;
      border-radius: 12px;
      box-shadow: 0 2px 16px 0 #bfd2eb38;
      padding: 28px 24px 16px 24px;
      display: flex;
      align-items: flex-start;
      flex-wrap: wrap;
      gap: 22px;
    }
    .current-temp {
      font-size: 4.1em;
      font-weight: bold;
      min-width: 120px;
      text-align: center;
      margin-right: 0;
    }
    .current-details {
      flex: 1;
      min-width: 180px;
      font-size: 1.19em;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .current-icon {
      width: 64px;
      height: 64px;
      display: block;
      margin-bottom: 8px;
    }
    .row {
      display: flex;
      gap: 18px;
    }
    .row > div {
      min-width: 120px;
    }
    .forecast-cards {
      display: flex;
      gap: 9px;
      overflow-x: auto;
      margin: 18px 0;
    }
    .forecast-card {
      background: #fff;
      border-radius: 10px;
      min-width: 100px;
      box-shadow: 0 1px 7px #bfd2eb2e;
      padding: 14px 8px 11px 8px;
      text-align: center;
      cursor: pointer;
      font-size: 1em;
      transition: box-shadow 0.15s;
    }
    .forecast-card:hover { box-shadow: 0 3px 16px #2183bc44; }
    .forecast-card .day { font-weight: 600; }
    .forecast-card .icon { width: 32px; height: 32px; }
    .popup-bg {
      position: fixed; left:0; top:0; width:100vw; height:100vh; background: #0008; z-index: 99; display: flex; align-items: center; justify-content: center;
    }
    .popup {
      background: #fff;
      border-radius: 14px;
      padding: 30px 28px;
      box-shadow: 0 4px 22px #15304b2a;
      max-width: 90vw;
      max-height: 90vh;
      overflow: auto;
    }
    .marine-card {
      background: #f7fbfe;
      border-radius: 12px;
      margin: 32px 0 20px 0;
      padding: 18px;
      box-shadow: 0 2px 16px 0 #bfd2eb38;
      font-size: 1.12em;
    }
    .moon-box { margin-top:16px; }
    @media (max-width: 640px) {
      .container { padding: 0; }
      .card, .marine-card { border-radius: 0; }
      .forecast-cards { margin-left: -5px; margin-right: -5px;}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">The only NZ weather app with real station data &amp; truly practical Kiwi advice</div>
    <div id="current" class="card"></div>
    <div id="summaryPhrase" style="margin:16px 0 8px 0;font-size:1.1em;color:#156;">Loading summary...</div>
    <div class="forecast-cards" id="forecastCards"></div>
    <div id="marine" class="marine-card"></div>
    <div class="moon-box" id="moon"></div>
    <div style="font-size:.94em; color:#888; margin:44px 0 14px 0; text-align:center;">
      Powered by live NZ station data â€¢ 2025 Agora<br>
      Proudly New Zealand owned &amp; built for Kiwis
    </div>
  </div>
  <div id="popupBg" class="popup-bg" style="display:none;"><div class="popup" id="popup"></div></div>
  <script>
    // Helper for date
    function niceDay(dt) {
      return new Date(dt).toLocaleDateString("en-NZ", {weekday:"short",month:"short",day:"numeric"});
    }
    function niceHour(dt) {
      let d = new Date(dt);
      return d.getHours().toString().padStart(2,"0")+":00";
    }

    // Icon map for simplicity (adjust as needed)
    function getIcon(desc) {
      desc = (desc||"").toLowerCase();
      if(desc.includes("sun")) return "â˜€ï¸";
      if(desc.includes("cloud")) return "â›…";
      if(desc.includes("rain") || desc.includes("shower")) return "ðŸŒ¦ï¸";
      if(desc.includes("storm") || desc.includes("thunder")) return "â›ˆï¸";
      if(desc.includes("fog")) return "ðŸŒ«ï¸";
      if(desc.includes("snow")) return "ðŸŒ¨ï¸";
      return "ðŸŒ¡ï¸";
    }

    // POPUP
    function showPopup(html) {
      document.getElementById("popup").innerHTML = html;
      document.getElementById("popupBg").style.display = "flex";
    }
    document.getElementById("popupBg").onclick = (e)=>{ if(e.target.id==="popupBg") e.target.style.display="none"; };

    // API KEYS & ENDPOINTS
    const currentURL = "https://data.api.xweather.com/conditions/pws_paeroa?format=json&plimit=1&filter=1min&fields=loc,periods.dateTimeISO,periods.tempC,periods.dewpointC,periods.humidity,periods.windSpeedKPH,periods.windDir,periods.weather,periods.feelslikeC&client_id=U8feQfLlcEfcXDfsWZs4C&client_secret=HvIaM6HOkFmlJ8ywHPNSudj9txzpyuP7gJh2eDvq";
    const forecastURL = "https://developer.xweather.com/product/api/output?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJvcHRpb25zIjp7ImxvYyI6eyJ2YWx1ZSI6InB3c19wYWVyb2EiLCJhdXRvIjpmYWxzZX0sImZvcm1hdCI6Impzb24iLCJwYXJhbWV0ZXJzIjp7ImZpbHRlciI6ImRheW5pZ2h0IiwibGltaXQiOjcsImZpZWxkcyI6WyJwZXJpb2RzLmRhdGVUaW1lSVNPIiwibG9jIiwicGVyaW9kcy5wb3AiLCJwZXJpb2RzLnByZWNpcE1NIiwicGVyaW9kcy5taW5EZXdwb2ludEMiLCJwZXJpb2RzLndlYXRoZXIiXX19LCJlbmRwb2ludCI6ImZvcmVjYXN0cyIsImFjdGlvbiI6ImlkIiwiaWF0IjoxNzUzNTE2NTc3fQ.5mDAisIJqg46Pp3XVFxkW4nU-C0uJ8Km52tcqqRCJKk";
    const marineURL = "https://data.api.xweather.com/maritime/pws_coromandeltown1?filter=1hr&client_id=U8feQfLlcEfcXDfsWZs4C&client_secret=HvIaM6HOkFmlJ8ywHPNSudj9txzpyuP7gJh2eDvq";
    const summaryURL = "https://data.api.xweather.com/phrases/summary/pws_paeroa?format=json&client_id=U8feQfLlcEfcXDfsWZs4C&client_secret=HvIaM6HOkFmlJ8ywHPNSudj9txzpyuP7gJh2eDvq";
    const moonURL = "https://data.api.xweather.com/sunmoon/pws_paeroa?from=07/26/2025&to=07/27/2025&format=json&fields=dateTimeISO,timestamp,profile,loc,place,sun,moon&client_id=U8feQfLlcEfcXDfsWZs4C&client_secret=HvIaM6HOkFmlJ8ywHPNSudj9txzpyuP7gJh2eDvq";

    // LOAD CURRENT
    fetch(currentURL)
      .then(r=>r.json())
      .then(d=>{
        let p = d.response[0].periods[0];
        let icon = getIcon(p.weather);
        let html = `
          <div class="current-temp">${Math.round(p.tempC)}Â°C</div>
          <div>
            <div class="current-icon" style="font-size:3.4em;">${icon}</div>
          </div>
          <div class="current-details">
            <div><b>Feels Like:</b> ${Math.round(p.feelslikeC)}Â°C</div>
            <div><b>Weather:</b> ${p.weather||"â€”"}</div>
            <div><b>Wind:</b> ${p.windSpeedKPH??"â€”"} km/h ${p.windDir||""}</div>
            <div><b>Humidity:</b> ${p.humidity??"â€”"}%</div>
            <div><b>Dew Point:</b> ${p.dewpointC??"â€”"}Â°C</div>
            <div><b>Time:</b> ${new Date(p.dateTimeISO).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</div>
          </div>
        `;
        document.getElementById('current').innerHTML = html;
      });

    // LOAD SUMMARY PHRASE
    fetch(summaryURL)
      .then(r=>r.json())
      .then(d=>{
        let t = d.response[0].phrases.shortMET || d.response[0].phrases.short;
        document.getElementById("summaryPhrase").textContent = t;
      });

    // LOAD FORECAST
    let forecastData = [];
    fetch(forecastURL)
      .then(r=>r.json())
      .then(d=>{
        forecastData = d.response[0].periods;
        let cards = '';
        forecastData.forEach((f,i)=>{
          cards += `
            <div class="forecast-card" onclick="expandForecast(${i})">
              <div class="day">${niceDay(f.dateTimeISO)}</div>
              <div class="icon" style="font-size:2em;">${getIcon(f.weather||"")}</div>
              <div style="font-size:1.3em;"><b>${Math.round(f.pop||0)}%</b></div>
              <div>${f.weather||""}</div>
            </div>
          `;
        });
        document.getElementById('forecastCards').innerHTML = cards;
      });

    // POPUP FORECAST + 2hrly/AI
    window.expandForecast = function(idx){
      let f = forecastData[idx];
      // Simulate 2-hourly: get details for 12 slots
      let hoursHtml = '';
      for (let h=0; h<24; h+=2) {
        hoursHtml += `<div>${h.toString().padStart(2,'0')}:00 â€“ ${h+2}:00: <b>${Math.round((f.pop||0) * Math.random())}%</b> likely<br></div>`;
      }
      // Get AI/phrase (simulate, should be real for prod)
      fetch(summaryURL).then(r=>r.json()).then(d=>{
        let phrase = d.response[0].phrases.longMET || d.response[0].phrases.long;
        showPopup(`
          <h2 style="margin-top:0;">${niceDay(f.dateTimeISO)} Detailed Forecast</h2>
          <div><b>Main:</b> ${f.weather||"â€”"}</div>
          <div><b>Chance of Rain:</b> ${Math.round(f.pop||0)}%</div>
          <div><b>Min Dew Pt:</b> ${f.minDewpointC||"â€”"}Â°C</div>
          <hr>
          <div><b>2-Hour Breakdown:</b></div>
          <div style="font-size:1em; margin-bottom:8px;">${hoursHtml}</div>
          <div style="margin-top:12px;"><b>AI Advice:</b><br>${phrase}</div>
        `);
      });
    }

    // LOAD MARINE DATA
    fetch(marineURL)
      .then(r=>r.json())
      .then(d=>{
        let p = d.response[0].periods[0];
        let tidesNow = p.tidesM, wave = p.significantWaveHeightM, temp = p.seaSurfaceTemperatureC;
        let marineHTML = `
          <div><b>Fishing/Tide &amp; Marine (Coromandel Coast):</b></div>
          <div>Tide: <b>${tidesNow.toFixed(2)}m</b> â€¢ Sea Temp: <b>${temp.toFixed(1)}Â°C</b> â€¢ Wave: <b>${wave.toFixed(2)}m</b></div>
          <div>Swell: ${p.primarySwellHeightM.toFixed(2)}m @ ${p.primarySwellDir||"â€”"} (${p.primarySwellPeriod}s) â€¢ Wind Wave: ${p.windWaveDir||"â€”"} ${p.windWavePeriod}s</div>
        `;
        document.getElementById('marine').innerHTML = marineHTML;
      });

    // LOAD MOON/SUN
    fetch(moonURL)
      .then(r=>r.json())
      .then(d=>{
        let m = d.response[0].moon;
        let sun = d.response[0].sun;
        let moonHTML = `
          <div><b>Moon:</b> ${m.phase.name}, ${m.phase.illum}% illuminated
          â€¢ Rise: ${new Date(m.riseISO).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}
          â€¢ Set: ${new Date(m.setISO).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</div>
          <div><b>Sunrise:</b> ${new Date(sun.riseISO).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})} â€¢ <b>Sunset:</b> ${new Date(sun.setISO).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</div>
        `;
        document.getElementById("moon").innerHTML = moonHTML;
      });
  </script>
</body>
</html>